<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>آروما - سفر بویایی خود را آغاز کنید</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@300;400;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&display=swap" rel="stylesheet">
    
    <!-- Font Awesome for Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" xintegrity="sha512-z3gLpd7yknf1YoNbCzqRKc4qyor8gaKU1qmn+CShxbuBusANI9QpRohGBreCFkKxLhei6S9CQXFEbbKuqLg0DA==" crossorigin="anonymous" referrerpolicy="no-referrer" />

    <!-- Custom Styles -->
    <style>
        body {
            font-family: 'Vazirmatn', sans-serif;
            background-color: #022c22; /* Emerald Green 950 */
            color: #F3F4F6; /* Light gray text */
        }
        .font-vazir {
            font-family: 'Vazirmatn', sans-serif;
        }
        .font-cinzel {
            font-family: 'Cinzel', serif;
        }
        .hero-bg {
            background-image: linear-gradient(to bottom, rgba(2, 44, 34, 0.8), rgba(2, 44, 34, 1)), url('https://images.unsplash.com/photo-1585399001829-d84c6d75b858?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1920&q=80');
            background-size: cover;
            background-position: center;
        }
        .btn-primary {
            background-color: #D4AF37; /* Gold color */
            color: #022c22; /* Dark Emerald for text */
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(212, 175, 55, 0.2);
        }
        .btn-primary:hover {
            background-color: #EACD65;
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(212, 175, 55, 0.3);
        }
        .card {
            background-color: #064e3b; /* Emerald Green 900 */
            border: 1px solid #065f46; /* Emerald Green 800 */
        }
        .modal-backdrop {
            background-color: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(5px);
        }
        .visual-option {
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .visual-option:hover {
            transform: scale(1.05);
        }
        .visual-option.selected {
            box-shadow: 0 0 0 4px #D4AF37;
            transform: scale(1.05);
        }
        .note-checkbox:checked + label {
            border-color: #D4AF37;
            background-color: #047857; /* Emerald 700 */
        }
        .note-checkbox:disabled + label {
            opacity: 0.5;
            cursor: not-allowed;
        }
        .validation-error {
            box-shadow: 0 0 0 2px #ef4444; /* Red-500 */
            animation: shake 0.5s;
        }
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }
        /* New Certificate Styles */
        .certificate-new {
            background-color: #064e3b;
            position: relative;
            overflow: hidden;
            border-radius: 0.75rem;
        }
        .certificate-new-bg {
            position: absolute;
            top: 0;
            left: -50%;
            width: 150%;
            height: 100%;
            background: linear-gradient(135deg, rgba(212, 175, 55, 0.15) 25%, transparent 25%),
                        linear-gradient(225deg, rgba(212, 175, 55, 0.15) 25%, transparent 25%);
            background-size: 100px 100px;
            transform: rotate(-45deg);
            opacity: 0.3;
        }
        .certificate-border {
            position: absolute;
            top: 0; right: 0; bottom: 0; left: 0;
            border-radius: 0.75rem;
            border: 2px solid #D4AF37;
            pointer-events: none;
        }
        /* Custom scrollbar for better aesthetics */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #064e3b; /* Emerald 900 */
        }
        ::-webkit-scrollbar-thumb {
            background: #D4AF37;
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #EACD65;
        }
    </style>
</head>
<body class="font-vazir">

    <!-- Header -->
    <header class="fixed top-0 left-0 right-0 z-50 bg-emerald-950 bg-opacity-80 backdrop-blur-sm shadow-md">
        <div class="container mx-auto px-6 py-3 flex justify-between items-center">
            <a href="#home" class="flex items-center">
                <img src="https://raw.githubusercontent.com/Aromamaking/Aroma/main/logo.png" alt="آروما لوگو" class="h-12">
            </a>
            <nav class="hidden md:flex space-x-8 space-x-reverse text-lg">
                <a href="#philosophy" class="text-gray-300 hover:text-white transition">فلسفه ما</a>
                <a href="#kits" class="text-gray-300 hover:text-white transition">کیت‌ها</a>
                <a href="#ocr" class="text-gray-300 hover:text-white transition">کشف با دوربین</a>
                <a href="#contact" class="text-gray-300 hover:text-white transition">تماس با ما</a>
            </nav>
            <button id="startJourneyBtnHeader" class="btn-primary font-bold py-2 px-6 rounded-lg text-lg">
                شروع سفر
            </button>
        </div>
    </header>

    <!-- Hero Section -->
    <main id="home" class="hero-bg pt-32 pb-20">
        <div class="container mx-auto px-6 text-center">
            <h2 class="text-4xl md:text-6xl font-bold text-white leading-tight mb-4">
                سفر بویایی خود را آغاز کنید
            </h2>
            <p class="text-xl md:text-2xl text-gray-300 mb-8 max-w-3xl mx-auto">
                با یک تجربه یکپارچه، رایحه‌ای را کشف و خلق کنید که بازتابی از عمیق‌ترین لایه‌های شخصیت شماست.
            </p>
            <button id="startJourneyBtnHero" class="btn-primary font-bold py-4 px-10 rounded-lg text-xl">
                شروع سفر بویایی من
            </button>
        </div>
    </main>
    
    <!-- Philosophy Section -->
    <section id="philosophy" class="py-20 bg-emerald-950">
        <div class="container mx-auto px-6 flex flex-col md:flex-row items-center gap-10">
            <div class="md:w-1/2">
                <img src="https://raw.githubusercontent.com/Aromamaking/Aroma/main/image1.png" alt="فلسفه آروما - عطرسازی هنرمندانه" class="rounded-xl shadow-lg w-full">
            </div>
            <div class="md:w-1/2">
                <h3 class="text-3xl font-bold mb-4 text-white">شما یک داستان هستید. رایحه شما، راوی آن است.</h3>
                <p class="text-lg text-gray-300 mb-4 leading-relaxed">
                    پیش از آنکه سخن بگویید، رایحه شما حضورتان را اعلام می‌کند. این یک انتخاب سطحی نیست؛ بلکه عمیق‌ترین بخش از هویت غیرکلامی شماست.
                </p>
                <p class="text-lg text-gray-300 leading-relaxed">
                    فلسفه ما در آروما، فراتر از ترکیب نت‌هاست. ما به شما کمک می‌کنیم تا داستانی که در درون خود دارید را پیدا کرده و آن را به یک اثر هنری بویایی تبدیل کنید. ما عطر نمی‌فروشیم؛ ما به شما کمک می‌کنیم خودتان را روایت کنید.
                </p>
            </div>
        </div>
    </section>

    <!-- Featured Kits Section -->
    <section id="kits" class="py-20">
        <div class="container mx-auto px-6">
            <h3 class="text-3xl font-bold text-center mb-12 text-white">کیت‌های کشف بر اساس آرکتایپ</h3>
            <div class="grid md:grid-cols-2 lg:grid-cols-4 gap-8">
                <!-- Kit 1: Ruler -->
                <div class="card rounded-xl overflow-hidden group flex flex-col items-center justify-start p-6 text-center h-full">
                    <div class="mb-4 text-yellow-400 group-hover:scale-110 transition-transform duration-300" style="font-size: 4rem;">
                        <i class="fa-solid fa-crown"></i>
                    </div>
                    <h4 class="text-2xl font-bold text-white mb-2">کیت حاکم</h4>
                    <p class="text-gray-300">رایحه‌های چوبی و چرمی برای شخصیتی قدرتمند و با اعتماد به نفس.</p>
                </div>
                <!-- Kit 2: Lover -->
                <div class="card rounded-xl overflow-hidden group flex flex-col items-center justify-start p-6 text-center h-full">
                    <div class="mb-4 text-yellow-400 group-hover:scale-110 transition-transform duration-300" style="font-size: 4rem;">
                        <i class="fa-solid fa-heart"></i>
                    </div>
                    <h4 class="text-2xl font-bold text-white mb-2">کیت عاشق</h4>
                    <p class="text-gray-300">عطرهای گلی و شیرین برای روحیه‌ای لطیف، صمیمی و سرشار از احساس.</p>
                </div>
                <!-- Kit 3: Explorer -->
                <div class="card rounded-xl overflow-hidden group flex flex-col items-center justify-start p-6 text-center h-full">
                    <div class="mb-4 text-yellow-400 group-hover:scale-110 transition-transform duration-300" style="font-size: 4rem;">
                        <i class="fa-solid fa-compass"></i>
                    </div>
                    <h4 class="text-2xl font-bold text-white mb-2">کیت جستجوگر</h4>
                    <p class="text-gray-300">نت‌های مرکباتی و تازه برای شخصیتی پویا، نوآور و عاشق تجربه.</p>
                </div>
                <!-- Kit 4: Creator -->
                <div class="card rounded-xl overflow-hidden group flex flex-col items-center justify-start p-6 text-center h-full">
                    <div class="mb-4 text-yellow-400 group-hover:scale-110 transition-transform duration-300" style="font-size: 4rem;">
                        <i class="fa-solid fa-pen-nib"></i>
                    </div>
                    <h4 class="text-2xl font-bold text-white mb-2">کیت خالق</h4>
                    <p class="text-gray-300">رایحه‌های غیرمعمول و هنری برای روحیه‌ای ساختارشکن و منحصربه‌فرد.</p>
                </div>
            </div>
        </div>
    </section>

    <!-- OCR Section -->
    <section id="ocr" class="py-20 bg-emerald-950">
        <div class="container mx-auto px-6 text-center">
            <i class="fa-solid fa-camera-retro text-yellow-400 text-5xl mb-4"></i>
            <h3 class="text-3xl font-bold text-center mb-4 text-white">کشف با دوربین</h3>
            <p class="text-lg text-gray-300 text-center mb-8 max-w-2xl mx-auto">
                عطری را دیده‌اید و می‌خواهید بیشتر درباره آن بدانید؟ از آن عکس بگیرید تا هوش مصنوعی ما آن را برای شما تحلیل کند.
            </p>
            <button id="startOcrBtn" class="btn-primary font-bold py-3 px-8 rounded-lg text-xl">
                شناسایی رایحه از روی تصویر
            </button>
        </div>
    </section>

    <!-- Footer -->
    <footer id="contact" class="bg-emerald-950 py-10 border-t border-emerald-900">
        <div class="container mx-auto px-6 text-center text-gray-300">
            <div class="mb-8 flex flex-col items-center">
                 <img src="https://raw.githubusercontent.com/Aromamaking/Aroma/main/logo.png" alt="آروما لوگو" class="h-16 mb-6">
                <div class="flex flex-col md:flex-row justify-center items-center gap-6 md:gap-12 text-lg">
                    <div class="flex items-center gap-3">
                        <i class="fa-solid fa-location-dot text-yellow-400"></i>
                        <span>قم، سالاریه، میدان میثم، مجتمع عصر جدید، طبقه همکف، پلاک G203</span>
                    </div>
                    <div class="flex items-center gap-3">
                        <i class="fa-solid fa-phone text-yellow-400"></i>
                        <a href="tel:09045353643" class="hover:text-white" dir="ltr">0904 535 3643</a>
                    </div>
                </div>
                <div class="flex justify-center items-center gap-8 mt-6 text-3xl">
                    <a href="https://instagram.com/aroma_making" target="_blank" class="text-gray-400 hover:text-white transition"><i class="fa-brands fa-instagram"></i></a>
                    <a href="https://wa.me/989126521596" target="_blank" class="text-gray-400 hover:text-white transition"><i class="fa-brands fa-whatsapp"></i></a>
                    <a href="https://t.me/amiraroma" target="_blank" class="text-gray-400 hover:text-white transition"><i class="fa-brands fa-telegram"></i></a>
                </div>
            </div>
            <div class="border-t border-emerald-800 pt-6">
                <p>&copy; 1403 (2024) | تمامی حقوق برای برند آروما محفوظ است.</p>
                <p class="mt-2 text-sm text-gray-500">طرح مفهومی و پلتفرم دیجیتال ارائه شده توسط مشاور شما</p>
            </div>
        </div>
    </footer>

    <!-- Journey Modal -->
    <div id="journeyModal" class="fixed inset-0 z-50 items-center justify-center modal-backdrop hidden">
        <div id="journeyContainer" class="card rounded-2xl shadow-2xl w-11/12 md:w-3/4 lg:w-2/3 max-w-5xl max-h-[90vh] flex flex-col transform transition-all duration-300 scale-95 opacity-0">
            <div class="p-4 border-b border-emerald-800 flex justify-between items-center">
                <h3 id="journeyTitle" class="text-2xl font-bold text-white">سفر بویایی شما</h3>
                <button id="closeJourneyBtn" class="text-gray-300 hover:text-white text-3xl">&times;</button>
            </div>
            <div id="journeyContent" class="p-6 md:p-8 overflow-y-auto flex-grow">
                <!-- Journey steps will be injected here by JavaScript -->
            </div>
            <div id="journeyFooter" class="p-4 border-t border-emerald-800 flex justify-between items-center">
                <button id="prevBtn" class="bg-emerald-700 text-white font-bold py-2 px-6 rounded-lg hover:bg-emerald-600 transition disabled:opacity-50 disabled:cursor-not-allowed">قبلی</button>
                <div id="stepIndicator" class="text-gray-400"></div>
                <button id="nextBtn" class="btn-primary font-bold py-2 px-6 rounded-lg disabled:opacity-50 disabled:cursor-not-allowed">بعدی</button>
            </div>
        </div>
    </div>

    <!-- Camera Modal -->
    <div id="cameraModal" class="fixed inset-0 z-[60] items-center justify-center modal-backdrop hidden">
        <div id="cameraContainer" class="card rounded-2xl shadow-2xl w-11/12 max-w-2xl flex flex-col transform transition-all duration-300 scale-95 opacity-0">
             <div class="p-4 border-b border-emerald-800 flex justify-between items-center">
                <h3 class="text-2xl font-bold text-white">شناسایی با دوربین</h3>
                <button id="closeCameraBtn" class="text-gray-300 hover:text-white text-3xl">&times;</button>
            </div>
            <div class="p-6">
                <video id="cameraFeed" class="w-full h-auto rounded-lg" autoplay playsinline></video>
                <canvas id="photoCanvas" class="hidden"></canvas>
            </div>
            <div class="p-4 border-t border-emerald-800 text-center">
                <button id="captureBtn" class="btn-primary font-bold py-3 px-8 rounded-lg text-lg">
                    <i class="fa-solid fa-camera mr-2"></i> عکس بگیر
                </button>
            </div>
        </div>
    </div>

    <!-- OCR Result Modal -->
    <div id="ocrResultModal" class="fixed inset-0 z-50 items-center justify-center modal-backdrop hidden">
        <div id="ocrResultContainer" class="card rounded-2xl shadow-2xl w-11/12 md:w-2/3 lg:w-1/2 max-w-3xl max-h-[90vh] flex flex-col transform transition-all duration-300 scale-95 opacity-0">
             <div class="p-4 border-b border-emerald-800 flex justify-between items-center">
                <h3 class="text-2xl font-bold text-white">تحلیل هوش مصنوعی</h3>
                <button id="closeOcrResultBtn" class="text-gray-300 hover:text-white text-3xl">&times;</button>
            </div>
            <div id="ocrResultContent" class="p-6 md:p-8 overflow-y-auto">
                <!-- OCR results will be injected here -->
            </div>
        </div>
    </div>


    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- Elements ---
            const journeyModal = document.getElementById('journeyModal');
            const journeyContainer = document.getElementById('journeyContainer');
            const journeyTitle = document.getElementById('journeyTitle');
            const journeyContent = document.getElementById('journeyContent');
            const journeyFooter = document.getElementById('journeyFooter');
            const prevBtn = document.getElementById('prevBtn');
            const nextBtn = document.getElementById('nextBtn');
            const stepIndicator = document.getElementById('stepIndicator');

            // --- Journey State ---
            let journeyState = {};

            const journeySteps = [
                'quiz_1', 'quiz_2', 'quiz_3', 'quiz_4', 'quiz_5', 'quiz_6',
                'results', 
                'personalization', 
                'final_offer',
                'certificate'
            ];

            const questions = [
                 {
                    type: 'visual',
                    question: "کدام یک از این فضاها بیشتر به شما حس تعلق می‌دهد؟",
                    options: [
                        { image: 'https://images.unsplash.com/photo-1517457373958-b7bdd4587205?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=800&q=80', scores: { lover: 1.5, explorer: 0.5 }, alt: 'جشن شلوغ و پرنور' },
                        { image: 'https://images.unsplash.com/photo-1481627834876-b7833e8f5570?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=800&q=80', scores: { ruler: 1.5, creator: 0.5 }, alt: 'کتابخانه ساکت و کلاسیک' },
                        { image: 'https://images.unsplash.com/photo-1513364776144-60967b0f800f?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=800&q=80', scores: { creator: 1.5, ruler: 0.2 }, alt: 'گالری هنری مینیمال' },
                        { image: 'https://images.unsplash.com/photo-1507525428034-b723a996f6ea?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=800&q=80', scores: { explorer: 1.5, lover: 0.2 }, alt: 'ساحل بکر و دست نخورده' }
                    ]
                },
                {
                    type: 'text',
                    question: "یک آخر هفته کاملاً آزاد دارید. ترجیح شما چیست؟",
                    options: [
                        { text: "برنامه‌ریزی برای یک سفر کوتاه و کشف یک مکان جدید.", scores: { explorer: 1.0 } },
                        { text: "دعوت از دوستان نزدیک برای یک مهمانی شام صمیمی در خانه.", scores: { lover: 1.0 } },
                        { text: "کار کردن روی یک پروژه شخصی خلاقانه که مدت‌هاست ذهن شما را درگیر کرده.", scores: { creator: 1.0 } },
                        { text: "شرکت در یک کنفرانس یا کارگاه برای پیشرفت شغلی و شبکه‌سازی.", scores: { ruler: 1.0 } }
                    ]
                },
                {
                    type: 'text',
                    question: "کدام کلمه برای شما مهم‌تر است؟",
                    options: [
                        { text: "موفقیت", scores: { ruler: 1.2 } },
                        { text: "اشتیاق", scores: { lover: 1.2 } },
                        { text: "آزادی", scores: { explorer: 1.2 } },
                        { text: "اصالت", scores: { creator: 1.2 } }
                    ]
                },
                 {
                    type: 'text',
                    question: "وقتی با یک چالش بزرگ روبرو می‌شوید، اولین واکنش شما چیست؟",
                    options: [
                        { text: "کنترل اوضاع را به دست می‌گیرم و یک استراتژی برای حل آن طراحی می‌کنم.", scores: { ruler: 1.0, creator: 0.3 } },
                        { text: "به دنبال یک راه حل خلاقانه و خارج از چارچوب می‌گردم.", scores: { creator: 1.0, explorer: 0.3 } },
                        { text: "با افراد مورد اعتمادم مشورت می‌کنم و از حمایت آن‌ها استفاده می‌کنم.", scores: { lover: 1.0 } },
                        { text: "آن را به عنوان یک ماجراجویی جدید می‌بینم و با آغوش باز به استقبالش می‌روم.", scores: { explorer: 1.0, lover: 0.3 } }
                    ]
                },
                {
                    type: 'text',
                    question: "کدام بافت را ترجیح می‌دهید؟",
                    options: [
                        { text: "لمس مخمل نرم و گران‌قیمت", scores: { lover: 1.2, ruler: 0.5 } },
                        { text: "لمس کتان طبیعی و راحت", scores: { explorer: 1.2, creator: 0.5 } }
                    ]
                },
                {
                    type: 'text',
                    question: "در یک سرمایه‌گذاری، کدام برای شما مهم‌تر است؟",
                    options: [
                        { text: "بازدهی بالا، حتی با ریسک زیاد", scores: { explorer: 1.2, creator: 0.3 } },
                        { text: "بازدهی مطمئن، حتی با سود کمتر", scores: { ruler: 1.2, lover: 0.3 } }
                    ]
                }
            ];

            const notesData = {
                top: [
                    { id: 'top1', name: 'ترنج' }, { id: 'top2', name: 'لیموترش' }, { id: 'top3', name: 'پرتقال' }, { id: 'top4', name: 'نارنگی ماندارین' },
                    { id: 'top5', name: 'گریپ فروت' }, { id: 'top6', name: 'اسطوخودوس' }, { id: 'top7', name: 'نعناع' }, { id: 'top8', name: 'آناناس' },
                    { id: 'top9', name: 'انگور فرنگی سیاه' }, { id: 'top10', name: 'سیب' }, { id: 'top11', name: 'هندوانه' }, { id: 'top12', name: 'آب دریا' },
                    { id: 'top13', name: 'فلفل صورتی' }, { id: 'top14', name: 'هل' }, { id: 'top15', name: 'جوز' }, { id: 'top16', name: 'زعفران' }
                ],
                middle: [
                    { id: 'mid1', name: 'رز' }, { id: 'mid2', name: 'یاس' }, { id: 'mid3', name: 'شمعدانی' }, { id: 'mid4', name: 'بهار نارنج' },
                    { id: 'mid5', name: 'شکوفه پرتقال' }, { id: 'mid6', name: 'زنبق' }, { id: 'mid7', name: 'بنفشه' }, { id: 'mid8', name: 'گل مریم' },
                    { id: 'mid9', name: 'ارکیده' }, { id: 'mid10', name: 'دارچین' }, { id: 'mid11', name: 'فلفل سیاه' }, { id: 'mid12', name: 'قهوه' },
                    { id: 'mid13', name: 'چای' }, { id: 'mid14', name: 'روایح دودی' }, { id: 'mid15', name: 'تنباکو' }, { id: 'mid16', name: 'جیر' }
                ],
                base: [
                    { id: 'base1', name: 'چوب صندل' }, { id: 'base2', name: 'چوب سدر' }, { id: 'base3', name: 'عود' }, { id: 'base4', name: 'پچولی (نعناع هندی)' },
                    { id: 'base5', name: 'خس خس (وتیور)' }, { id: 'base6', name: 'مشک' }, { id: 'base7', name: 'کهربا' }, { id: 'base8', name: 'وانیل' },
                    { id: 'base9', name: 'دانه تونکا' }, { id: 'base10', name: 'چرم' }, { id: 'base11', name: 'خزه بلوط' }, { id: 'base12', name: 'لابدانیوم' }
                ]
            };

            const archetypeData = {
                ruler: {
                    title: "حاکم",
                    explanation: "شما شخصیتی قدرتمند، منظم و با اعتماد به نفس هستید که به کیفیت، کنترل و ساختارهای پایدار اهمیت می‌دهید.",
                    fragranceLink: "این پروفایل جذب رایحه‌هایی می‌شود که حس قدرت و وقار را منتقل می‌کنند: نت‌های سنگین، چوبی، چرمی و ادویه‌ای.",
                    recommendedNotes: { top: ['زعفران'], middle: ['جیر', 'روایح دودی'], base: ['چوب سدر', 'چرم'] },
                    scentProfile: 'چوبی، قدرتمند، باوقار',
                    season: 'پاییز و زمستان',
                    occasion: 'جلسات رسمی، رویدادهای شبانه',
                    story: 'قدرت در سکوت، شکوه در اصالت.'
                },
                creator: {
                    title: "خالق",
                    explanation: "شما روحیه‌ای نوآور، مستقل و دارای اصالت دارید و از ساختن چیزهای جدید و بیان خود به شیوه‌ای منحصربه‌فرد لذت می‌برید.",
                    fragranceLink: "این پروفایل جذب رایحه‌های ساختارشکن و غیرمنتظره می‌شود: نت‌های سبز، معدنی، و ترکیبات غیرمعمول.",
                    recommendedNotes: { top: ['گریپ فروت', 'فلفل صورتی'], middle: ['زنبق', 'شمعدانی'], base: ['خس خس (وتیور)', 'پچولی (نعناع هندی)'] },
                    scentProfile: 'هنری، سبز، غیرمنتظره',
                    season: 'بهار و پاییز',
                    occasion: 'رویدادهای هنری، محیط کار خلاق',
                    story: 'شکستن مرزها، خلق یک امضای جدید.'
                },
                lover: {
                    title: "عاشق",
                    explanation: "شما شخصیتی احساسی، خونگرم و اجتماعی دارید و برای زیبایی، هماهنگی و ارتباطات عمیق ارزش قائل هستید.",
                    fragranceLink: "این پروفایل جذب رایحه‌هایی می‌شود که حس صمیمیت و جذابیت را القا می‌کنند: نت‌های گلی، شیرین، میوه‌ای و شرقی.",
                    recommendedNotes: { top: ['ترنج'], middle: ['رز', 'یاس', 'بهار نارنج'], base: ['وانیل', 'مشک'] },
                    scentProfile: 'گرم، شیرین، اغواگر',
                    season: 'تمام فصول',
                    occasion: 'ملاقات‌های عاشقانه، دورهمی‌های صمیمی',
                    story: 'روایتگر شور و صمیمیت.'
                },
                explorer: {
                    title: "جستجوگر",
                    explanation: "شما شخصیتی ماجراجو، مستقل و پرانرژی دارید و از تجربه کردن، یادگیری و شکستن مرزها لذت می‌برید.",
                    fragranceLink: "این پروفایل جذب رایحه‌هایی می‌شود که حس طراوت و آزادی را منتقل می‌کنند: نت‌های مرکباتی، آروماتیک و دریایی.",
                    recommendedNotes: { top: ['لیموترش', 'آب دریا'], middle: ['اسطوخودوس', 'چای'], base: ['خزه بلوط', 'کهربا'] },
                    scentProfile: 'تازه، پرانرژی، آزاد',
                    season: 'بهار و تابستان',
                    occasion: 'فعالیت‌های روزانه، سفر و ماجراجویی',
                    story: 'دعوت به کشف ناشناخته‌ها.'
                }
            };
            
            function resetJourney() {
                journeyState = {
                    currentStepIndex: 0,
                    answers: {},
                    archetype: { primary: null, secondary: null },
                    selectedNotes: { top: [], middle: [], base: [] },
                    perfumeName: ''
                };
            }

            function openJourneyModal() {
                resetJourney();
                journeyModal.classList.remove('hidden');
                journeyModal.classList.add('flex');
                setTimeout(() => {
                    journeyContainer.classList.remove('scale-95', 'opacity-0');
                }, 10);
                renderJourneyStep();
            }

            function closeJourneyModal() {
                journeyContainer.classList.add('scale-95', 'opacity-0');
                setTimeout(() => {
                    journeyModal.classList.add('hidden');
                    journeyModal.classList.remove('flex');
                }, 300);
            }

            document.getElementById('startJourneyBtnHeader').addEventListener('click', openJourneyModal);
            document.getElementById('startJourneyBtnHero').addEventListener('click', openJourneyModal);
            document.getElementById('closeJourneyBtn').addEventListener('click', closeJourneyModal);

            function renderJourneyStep() {
                const stepId = journeySteps[journeyState.currentStepIndex];
                journeyContent.innerHTML = ''; // Clear previous content
                
                // Scroll to top of content area on step change
                journeyContent.scrollTop = 0;

                if (stepId.startsWith('quiz')) {
                    renderQuizStep();
                } else if (stepId === 'results') {
                    renderResultsStep();
                } else if (stepId === 'personalization') {
                    renderPersonalizationStep();
                } else if (stepId === 'final_offer') {
                    renderFinalOfferStep();
                } else if (stepId === 'certificate') {
                    renderCertificateStep();
                }
                updateJourneyUI();
            }
            
            function renderQuizStep() {
                const questionIndex = journeyState.currentStepIndex;
                const stepData = questions[questionIndex];
                let contentHtml = '';

                if (stepData.type === 'visual') {
                    const optionsHtml = stepData.options.map((opt, index) => `
                        <div class="cursor-pointer visual-option rounded-lg overflow-hidden ${journeyState.answers[questionIndex] === index ? 'selected' : ''}" data-index="${index}">
                            <img src="${opt.image}" alt="${opt.alt}" class="w-full h-40 md:h-48 object-cover">
                        </div>
                    `).join('');
                    contentHtml = `<div class="grid grid-cols-2 md:grid-cols-4 gap-4">${optionsHtml}</div>`;
                } else {
                    const optionsHtml = stepData.options.map((opt, index) => `
                        <label class="block card p-4 rounded-lg cursor-pointer hover:bg-emerald-800 transition border-2 ${journeyState.answers[questionIndex] === index ? 'border-yellow-400' : 'border-transparent'}">
                            <input type="radio" name="q${questionIndex}" value="${index}" class="hidden" ${journeyState.answers[questionIndex] === index ? 'checked' : ''}>
                            <span class="text-lg">${opt.text}</span>
                        </label>
                    `).join('');
                    contentHtml = `<div class="grid grid-cols-1 md:grid-cols-2 gap-4">${optionsHtml}</div>`;
                }
                
                journeyContent.innerHTML = `
                    <h4 class="text-2xl font-bold mb-6 text-center text-white">${stepData.question}</h4>
                    ${contentHtml}
                `;
                
                // Add event listeners
                if (stepData.type === 'visual') {
                    journeyContent.querySelectorAll('.visual-option').forEach(el => {
                        el.addEventListener('click', (e) => {
                            journeyState.answers[questionIndex] = parseInt(e.currentTarget.dataset.index);
                            renderJourneyStep();
                        });
                    });
                } else {
                    journeyContent.querySelectorAll(`input[name="q${questionIndex}"]`).forEach(radio => {
                        radio.addEventListener('change', (e) => {
                            journeyState.answers[questionIndex] = parseInt(e.target.value);
                            renderJourneyStep();
                        });
                    });
                }
            }

            function renderResultsStep() {
                const scores = { ruler: 0, creator: 0, lover: 0, explorer: 0 };
                for(const qIndex in journeyState.answers) {
                    const answerIndex = journeyState.answers[qIndex];
                    const answerScores = questions[qIndex].options[answerIndex].scores;
                    for (const archetype in answerScores) {
                        scores[archetype] += answerScores[archetype];
                    }
                }
                
                const sortedArchetypes = Object.entries(scores).sort((a, b) => b[1] - a[1]);
                journeyState.archetype.primary = sortedArchetypes[0][0];
                journeyState.archetype.secondary = sortedArchetypes[1][0];

                const primary = archetypeData[journeyState.archetype.primary];
                const secondary = archetypeData[journeyState.archetype.secondary];
                
                const hybridTitle = `«${primary.title} با رگه‌هایی از ${secondary.title}»`;

                // Pre-populate selected notes
                const recommended = {
                    top: [...new Set([...primary.recommendedNotes.top, ...secondary.recommendedNotes.top])].slice(0, 2),
                    middle: [...new Set([...primary.recommendedNotes.middle, ...secondary.recommendedNotes.middle])].slice(0, 3),
                    base: [...new Set([...primary.recommendedNotes.base, ...secondary.recommendedNotes.base])].slice(0, 2)
                };
                journeyState.selectedNotes = JSON.parse(JSON.stringify(recommended));

                journeyContent.innerHTML = `
                    <div class="animate-fade-in text-right">
                        <p class="text-xl text-yellow-400 mb-2">مرحله ۱: تحلیل شخصیت شما</p>
                        <h4 class="text-4xl font-bold text-white mb-4">${hybridTitle}</h4>
                        
                        <div class="border-t border-b border-emerald-800 py-4 my-4">
                            <h5 class="text-xl font-bold text-white mb-2">تحلیل شخصیت:</h5>
                            <p class="text-lg text-gray-300">${primary.explanation} این ویژگی‌ها با استقلال‌طلبی و خلاقیت آرکتایپ ${secondary.title} ترکیب شده و شخصیتی چندبعدی و منحصربه‌فرد را شکل می‌دهد.</p>
                        </div>

                        <div class="border-b border-emerald-800 py-4 my-4">
                            <h5 class="text-xl font-bold text-white mb-2">نت‌های پیشنهادی برای شما:</h5>
                            <p class="text-lg text-gray-300">ترکیبی هوشمند از رایحه‌های مرتبط با هر دو آرکتایپ شما، یک پروفایل بویایی پیچیده و خاص ایجاد می‌کند.</p>
                        </div>
                    </div>
                `;
            }

            function renderPersonalizationStep() {
                const limits = { top: 2, middle: 3, base: 2 };

                const generateNotesHTML = (category) => {
                    return notesData[category].map(note => {
                        const isChecked = journeyState.selectedNotes[category].includes(note.name);
                        const isDisabled = !isChecked && journeyState.selectedNotes[category].length >= limits[category];
                        return `
                            <div>
                                <input type="checkbox" id="${note.id}" name="${category}" value="${note.name}" class="hidden note-checkbox" ${isChecked ? 'checked' : ''} ${isDisabled ? 'disabled' : ''}>
                                <label for="${note.id}" class="block text-center cursor-pointer p-3 rounded-lg border-2 border-emerald-700 hover:border-yellow-400 transition-colors duration-200">
                                    ${note.name}
                                </label>
                            </div>
                        `;
                    }).join('');
                };

                const updateSummaryHTML = () => {
                    let summaryHtml = '';
                    for (const category in journeyState.selectedNotes) {
                        const notes = journeyState.selectedNotes[category];
                        summaryHtml += `
                            <div>
                                <h5 class="font-bold text-yellow-400 mb-2 capitalize">${category === 'top' ? 'آغازی' : (category === 'middle' ? 'میانی' : 'پایانی')}:</h5>
                                <div id="summary-${category}" class="text-gray-300 min-h-[50px]">
                                    ${notes.length > 0 ? notes.map(note => `<span class="inline-block bg-emerald-800 rounded-full px-3 py-1 text-sm font-semibold text-gray-200 mr-2 mb-2">${note}</span>`).join('') : '<span class="text-gray-500">...</span>'}
                                </div>
                            </div>
                        `;
                    }
                    return summaryHtml;
                };

                journeyContent.innerHTML = `
                    <h3 class="text-2xl font-bold text-center mb-4 text-white">مرحله ۲: شخصی‌سازی رایحه</h3>
                    <p class="text-md text-gray-300 text-center mb-8 max-w-2xl mx-auto">
                        نت‌های پیشنهادی ما برای شما انتخاب شده‌اند. می‌توانید آن‌ها را ویرایش کرده یا ترکیب کاملاً جدیدی خلق کنید.
                    </p>
                    <div class="grid lg:grid-cols-3 gap-8">
                        <div class="card p-6 rounded-xl">
                            <h4 class="text-xl font-bold text-yellow-400 border-b-2 border-yellow-400 pb-2 mb-4">نت‌های آغازی (حداکثر ${limits.top})</h4>
                            <div class="space-y-3">${generateNotesHTML('top')}</div>
                        </div>
                        <div class="card p-6 rounded-xl">
                            <h4 class="text-xl font-bold text-yellow-400 border-b-2 border-yellow-400 pb-2 mb-4">نت‌های میانی (حداکثر ${limits.middle})</h4>
                            <div class="space-y-3">${generateNotesHTML('middle')}</div>
                        </div>
                        <div class="card p-6 rounded-xl">
                            <h4 class="text-xl font-bold text-yellow-400 border-b-2 border-yellow-400 pb-2 mb-4">نت‌های پایانی (حداکثر ${limits.base})</h4>
                            <div class="space-y-3">${generateNotesHTML('base')}</div>
                        </div>
                    </div>
                     <div class="card mt-12 p-8 rounded-xl max-w-4xl mx-auto">
                        <h4 class="text-2xl font-bold text-white mb-6 text-center">ترکیب نهایی شما</h4>
                        <div class="grid md:grid-cols-3 gap-6 text-center mb-6">${updateSummaryHTML()}</div>
                        <div class="mt-6">
                            <input type="text" id="perfumeNameInput" placeholder="نام عطر خود را وارد کنید..." value="${journeyState.perfumeName}" class="w-full bg-emerald-800 border border-emerald-700 rounded-lg px-4 py-3 text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-yellow-400 transition-shadow">
                        </div>
                    </div>
                `;

                journeyContent.querySelectorAll('.note-checkbox').forEach(checkbox => {
                    checkbox.addEventListener('change', (e) => {
                        const category = e.target.name;
                        const value = e.target.value;
                        if (e.target.checked) {
                            if (journeyState.selectedNotes[category].length < limits[category]) {
                                journeyState.selectedNotes[category].push(value);
                            }
                        } else {
                            journeyState.selectedNotes[category] = journeyState.selectedNotes[category].filter(note => note !== value);
                        }
                        renderPersonalizationStep(); // Re-render to update disabled states and summary
                    });
                });
                
                journeyContent.getElementById('perfumeNameInput').addEventListener('input', (e) => {
                    journeyState.perfumeName = e.target.value;
                    updateJourneyUI();
                });
            }

            function renderFinalOfferStep() {
                journeyContent.innerHTML = `
                    <h3 class="text-2xl font-bold text-center mb-4 text-white">مرحله نهایی: عطر شما آماده است!</h3>
                    <p class="text-md text-gray-300 text-center mb-8 max-w-2xl mx-auto">
                        رایحه <strong class="text-yellow-400">"${journeyState.perfumeName}"</strong> بر اساس انتخاب شما طراحی شده است. حالا می‌توانید آن را تجربه کنید.
                    </p>
                    <div class="grid md:grid-cols-2 gap-8 max-w-4xl mx-auto">
                        <div id="orderKitBtn" class="card p-8 rounded-xl flex flex-col items-center text-center border-2 border-transparent hover:border-yellow-400 transition cursor-pointer">
                            <h4 class="text-2xl font-bold text-white mb-4">گزینه ۱: کیت کشف</h4>
                            <p class="text-gray-300 mb-6 flex-grow">یک کیت نمونه حاوی عطر شخصی‌سازی شده خودتان را دریافت کنید تا آن را روی پوست خود امتحان کرده و از انتخاب نهایی مطمئن شوید.</p>
                            <span class="btn-primary font-bold py-3 px-8 rounded-lg text-lg w-full mt-4">سفارش کیت کشف</span>
                        </div>
                        <div id="orderBottleBtn" class="card p-8 rounded-xl flex flex-col items-center text-center border-2 border-transparent hover:border-yellow-400 transition cursor-pointer">
                            <h4 class="text-2xl font-bold text-white mb-4">گزینه ۲: بطری کامل</h4>
                            <p class="text-gray-300 mb-6 flex-grow">اگر از ترکیب خود مطمئن هستید، بطری کامل عطر منحصربه‌فرد خود را سفارش دهید و از خلق اثر هنری خود لذت ببرید.</p>
                            <span class="bg-emerald-700 text-white font-bold py-3 px-8 rounded-lg text-lg w-full mt-4 hover:bg-emerald-600">سفارش بطری کامل</span>
                        </div>
                    </div>
                `;

                journeyContent.getElementById('orderKitBtn').addEventListener('click', () => {
                    journeyState.currentStepIndex++;
                    renderJourneyStep();
                });
                journeyContent.getElementById('orderBottleBtn').addEventListener('click', () => {
                    journeyState.currentStepIndex++;
                    renderJourneyStep();
                });
            }

            function renderCertificateStep() {
                const primary = archetypeData[journeyState.archetype.primary];
                const secondary = archetypeData[journeyState.archetype.secondary];
                const hybridTitle = `«${primary.title} با رگه‌هایی از ${secondary.title}»`;
                const allNotes = [
                    ...journeyState.selectedNotes.top,
                    ...journeyState.selectedNotes.middle,
                    ...journeyState.selectedNotes.base
                ];
                const today = new Date();
                const issueDate = new Intl.DateTimeFormat('fa-IR').format(today);

                journeyContent.innerHTML = `
                    <div class="certificate-new p-8 max-w-4xl mx-auto animate-fade-in text-white">
                        <div class="certificate-new-bg"></div>
                        <div class="certificate-border"></div>
                        <div class="relative z-10">
                            <div class="text-center">
                                <h2 class="font-cinzel text-3xl text-yellow-400 tracking-widest">CERTIFICATE</h2>
                                <p class="font-cinzel text-lg text-gray-200">OF SCENT AUTHENTICITY
